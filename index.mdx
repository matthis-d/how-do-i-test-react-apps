export { yellow as theme } from 'mdx-deck/themes';
import { Image, Appear } from 'mdx-deck';
import CodeBlock from './CodeBlock';

## Comment je teste une application React ?

---

## Premi√®re √©tape

Trouver un runner

---

<Image src="./jest-logo.png" height="200px" width="200px" />

## Jest

---

### 1 - Zero config

- Watch mode interactif et rapide
- Librairie d'assertion
- Nom des fichiers
- Asynchronisme (`async/await`)

---

### 2 - Snapshots

Fait une capture du r√©sultat

```js
it('should match snapshot', () => {
  expect(myLegacyResult).toMatchSnapshot();
});
```

---

### 3 - JSDOM

- Embarque un browser en m√©moire (avec ses API)
- Permet de tester en rendu DOM
- D√©sactivable pour une cible NodeJS

---

### 4 - Mocking

- Possibilit√© de mocker tout ou partie d'un module

```js
jest.mock('imported-module');
jest.mock('./my-module');
```

- Mocking par d√©faut possible (`__mocks__`)
- Assertions sur les mocks

---

## Deuxi√®me √©tape

Quelle lib pour tester mon code React ?

---

### Diff√©rentes possibilit√©s

<ul style={{ listStyleType: 'none' }}>
  <Appear>
    <li>React Test Utils</li>
    <li>React test renderer</li>
    <li>Enzyme</li>
    <li>react-testing-library</li>
  </Appear>
</ul>

---

### React Test Utils

<Appear>
  <Image src="./react-test-utils.png" height="600px" width="1163px" />
</Appear>

---

### React test renderer

<Appear>
  <Image src="./react-test-renderer.png" height="200px" width="1163px" />
</Appear>

---

### Enzyme

- Solution propos√©e par Airbnb
- Propose une API tr√®s riche
- Une des plus utilis√©es dans la communaut√©

---

### Enzyme

Deux fa√ßons de tester

- Shallow
- Mount

---

### Enzyme - Shallow

- Composant en isolation
- Tous les √©l√©ments enfants sont des `div`
- Tests proches de l'impl√©mentation

---

### Enzyme - Mount

- Composant rendu avec ses enfants
- DOM n√©cessaire

---

### Enzyme - Qualit√©s

- API avec de nombreux utilitaires (`find`, `props`, `state`)
- Grosse communaut√©
- Documentation avec de nombreux exemples

---

### Enzyme - D√©fauts

Trop proche de l'impl√©mentation

<Image src="./enzyme-mount.png" width="1163px" height="531px" />

---

### Enzyme - D√©fauts

Simulations d'√©v√©nements  
Ce ne sont pas des vrais √©v√©nements DOM (SyntheticEvents)

<Image src="./Simulate-Dan-tweet.png" height="531px" width="807px" />

---

### üêê react-testing-library

---

### üêê react-testing-library - Philosophie

<Image src="./react-testing-library.png" height="307px" width="807px" />

---

### üêê react-testing-library - Philosophie

- Pas de Shallow
- N√©cessite un DOM
- Rend le composant entier dans un container (`div` par d√©faut)

---

### üêê react-testing-library - Qualit√©s

- Tests proches de l'utilisation r√©elle
- Vrais √©v√©nements DOM
- API simple

---

### üêê react-testing-library - D√©fauts

- API trop simple ?
- Obligation de tests d'int√©grations (Redux, Router, etc.)
- Passage par des API DOM parfois

---

### üêê react-testing-library - Pourquoi ?

Force √† √™tre proche de l'utilisation

`getByText`, `getByTitle`, `getByAltText`, etc.

=> Pousse √† faire du code accessible (a11y)

---

### üêê react-testing-library - Pourquoi ?

Tests qui correspondent au vrai comportement

Pousse √† int√©grer r√©ellement le composant dans Redux, dans le routeur notamment

```js
test('can render with redux with custom initial state', () => {
  const { getByTestId, getByText } = renderWithRedux(<ConnectedCounter />, {
    initialState: { count: 3 }
  });
  fireEvent.click(getByText('-'));
  expect(getByTestId('count-value').textContent).toBe('2');
});
```

---

### üêê react-testing-library - Pourquoi ?

Supporte les actions asynchrones (appels API au chargement par exemple)

```js
it('increments count', async () => {
  // Render new instance in every test to prevent leaking state
  const { getByText } = renderComponent({ count: 5 });

  // It takes time for the button to appear because
  // the GET request has a slight delay
  await waitForElement(() => getByText('+1'));
  fireEvent.click(getByText('+1'));

  // The counter doesn't update immediately because
  // the POST request is asynchronous
  await waitForElement(() => getByText(/clicked 6 times/i));
});
```

---

## Comment je teste une application React ?

<ul style={{ listStyleType: 'none' }}>
  <Appear>
    <li>
      Utilisation de <CodeBlock>Jest</CodeBlock>
    </li>
    <li>Tests unitaires des m√©thodes utilitaires et de Redux</li>
    <li>
      Tests d'int√©gration des composants avec{' '}
      <CodeBlock>react-testing-library</CodeBlock> (plus plugins)
    </li>
    <li>Seules les r√©ponses des API sont mock√©es</li>
  </Appear>
</ul>

---

## Merci
